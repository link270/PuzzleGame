<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Puzzle Game</title>
</head>
<body>
  <h1>Welcome to the Puzzle Game</h1>
  <form id="player-form">
    <input type="text" id="player-name" placeholder="Enter your name" required />
    <button type="submit">Start Game</button>
  </form>

  <div id="game" style="display:none;">
    <p>Time: <span id="timer-display">0.00 seconds</span></p>
    <p>Hello, <span id="name-display"></span>! Your score is: <span id="score">0</span></p>
    <button onclick="increaseScore()">Solve Puzzle</button>
    <button onclick="submitScore()">Submit Score</button>
  </div>


    <h2>Grid Math Puzzle</h2>
    <div id="puzzle-grid"></div>
    <p><strong>Correct Answer:</strong> <span id="puzzle-answer">?</span></p>
    <button onclick="evaluatePuzzle()">Submit</button>


    <style>
        #puzzle-grid {
            display: grid;
            grid-template-columns: repeat(6, 50px); /* 5 columns + 1 for labels */
            grid-template-rows: repeat(6, 50px);    /* 5 rows + 1 for labels */
            gap: 2px;
        }
        
        .cell {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border: 1px solid #888;
            background-color: white;
        }
        
        .op-add    { background-color: lightgreen; }
        .op-sub    { background-color: lightcoral; }
        .op-mul    { background-color: khaki; }
    </style>



    <script>
        const size = 5;
        const labelNumbers = shuffle([...Array(size * 2).keys()].map(n => n + 1));
        const bottomNumbers = labelNumbers.slice(0, size);
        const sideNumbers = labelNumbers.slice(size, size*2);

        const operations = ['add', 'subtract', 'multiply'];
        const opClasses = {
            add: 'op-add',
            subtract: 'op-sub',
            multiply: 'op-mul'
        };

        const puzzle = [];
        const numOps = 3 + Math.floor(Math.random() *(4 - 1) + 1);

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function generatePuzzle() {
            const grid = document.getElementById('puzzle-grid');

            // Generate empty 6x6 grid (0,0 is blank)
            for (let row = 0; row <= size; row++) {
                for (let col = 0; col <= size; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');

                    if (row === size && col === 0) {
                    // Top-left corner blank
                    } else if (row === size) {
                    // Top row = column headers
                    cell.textContent = bottomNumbers[col - 1];
                    } else if (col === 0) {
                    // Left col = row headers
                    cell.textContent = sideNumbers[row];
                    } else {
                    // Empty op cell
                    cell.dataset.x = col - 1;
                    cell.dataset.y = row - 1;
                    }

                    grid.appendChild(cell);
                }
            }

            // Randomly place a few operation cells
            for (let i = 0; i < numOps; i++) {
                const x = Math.floor(Math.random() * (size - 1) + 1);
                const y = Math.floor(Math.random() * (size - 1));
                const op = operations[Math.floor(Math.random() * operations.length)];
                // Avoid duplicates
                if (puzzle.find(p => p.x === x && p.y === y)) {
                    i--; continue;
                
                console.log("Hello");
            }

            puzzle.push({ x, y, op });
            const index = ((y + 1) * (size + 1)) + (x + 1);
            const cell = document.getElementsByClassName('cell')[index];
            cell.classList.add(`op-${op}`);
            }
        }

        function evaluatePuzzle() {
            let total = null;
            let breakdown = [];

            for (const { x, y, op } of puzzle) {
            const a = sideNumbers[y];
            const b = bottomNumbers[x];
            let result = 0;

            if (op === 'add') result = a + b;
            else if (op === 'subtract') result = a - b;
            else if (op === 'multiply') result = a * b;

            breakdown.push(`${a} ${op} ${b} = ${result}`);
            total = total === null ? result : total + result; // just sum all results
            }

            document.getElementById('puzzle-answer').textContent = total + " (" + breakdown.join(", ") + ")";
        }

        generatePuzzle();
    </script>


  <script type="module">
    // Firebase config
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyCb-K15oWqXe4OhkHaamfGEGOsjKrADb3c",
        authDomain: "puzzlegame-b1e5b.firebaseapp.com",
        projectId: "puzzlegame-b1e5b",
        storageBucket: "puzzlegame-b1e5b.firebasestorage.app",
        messagingSenderId: "498776276471",
        appId: "1:498776276471:web:901ffb5eb29cf5596942f2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let startTime;
    let timerInterval;

    let playerName = '';
    let score = 0;

    let puzzles = {}


    const form = document.getElementById('player-form');
    const game = document.getElementById('game');
    const nameDisplay = document.getElementById('name-display');
    const scoreDisplay = document.getElementById('score');


    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            document.getElementById("timer-display").textContent = `${elapsed} seconds`;
        }, 100);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        const finalTime = ((Date.now() - startTime) / 1000).toFixed(2);
        console.log(`Final time: ${finalTime} seconds`);
        return parseFloat(finalTime);
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      playerName = document.getElementById('player-name').value;
      nameDisplay.textContent = playerName;
      form.style.display = 'none';
      game.style.display = 'block';
      startTimer();
    });

    window.increaseScore = () => {
      score++;
      scoreDisplay.textContent = score;

      const endTime = stopTimer();
      puzzles["puzzle" + score] = {completed: true, score: score, time: endTime};
      startTimer();
    };

    window.submitScore = async () => {
        const playerData = {
            name: playerName,
            puzzles: puzzles
        };

      await setDoc(doc(db, "players", playerName), playerData);
      alert('Score submitted!');
    };
  </script>
</body>
</html>
